<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Worddle</title>
</head>

<style>
    .box {
        width: 40px;
        height: 40px;
        background-color: black;
        color: white;
        display: flex;
        justify-content: center;
        align-items: center;
        border: 2px solid #b1b1b1;
        border-radius: 0px;
        margin: 2px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        font-size: 30px;
        
    }
    .box_row{
        display: flex;
        justify-content: center; 
        align-items: center;
        height: 50px;
    }
    .keyboard {
    display: flex;
    flex-direction: column;
    gap: 10px; /* Space between rows */
    margin-top: 20px;
    }

    .row {
        display: flex;
        gap: 10px; /* Space between keys */
        justify-content: center;
    }

    .key {
        width: 50px;
        height: 50px;
        background-color: #4CAF50;
        color: white;
        display: flex;
        justify-content: center;
        align-items: center;
        border-radius: 5px;
        font-size: 18px;
        font-weight: bold;
        cursor: pointer;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
    }

    .key:hover {
        background-color: #45a049;
    }
</style>
<body style="background-color: black;">
    <h1 style="text-align: center; color: white;">Worddle {{line_n}}</h1>
    <hr style="height: 2px; background-color: white;">
    <div class="box_row">
        <div class="box" style="background-color: {{col.0}};">
             {{lett.0.0}}
         </div>
        <div class="box" style="background-color: {{col.1}};">
             {{lett.0.1}}
         </div>
        <div class="box" style="background-color: {{col.2}};">
             {{lett.0.2}}
         </div>
        <div class="box" style="background-color: {{col.3}};">
             {{lett.0.3}}
         </div>
        <div class="box" style="background-color: {{col.4}};">
             {{lett.0.4}}
         </div>
     </div>
     <div class="box_row">
        <div class="box" style="background-color: {{col.5}};">
             {{lett.1.0}}
         </div>
        <div class="box" style="background-color: {{col.6}};">
             {{lett.1.1}}
         </div>
        <div class="box" style="background-color: {{col.7}};">
             {{lett.1.2}}
         </div>
        <div class="box" style="background-color: {{col.8}};">
             {{lett.1.3}}
         </div>
        <div class="box" style="background-color: {{col.9}};">
             {{lett.1.4}}
         </div>
     </div>
     <div class="box_row">
        <div class="box" style="background-color: {{col.10}};">
             {{lett.2.0}}
         </div>
        <div class="box" style="background-color: {{col.11}};">
             {{lett.2.1}}
         </div>
        <div class="box" style="background-color: {{col.12}};">
             {{lett.2.2}}
         </div>
        <div class="box" style="background-color: {{col.13}};">
             {{lett.2.3}}
         </div>
        <div class="box" style="background-color: {{col.14}};">
             {{lett.2.4}}
         </div>
     </div>
     <div class="box_row">
        <div class="box" style="background-color: {{col.15}};">
             {{lett.3.0}}
         </div>
        <div class="box" style="background-color: {{col.16}};">
             {{lett.3.1}}
         </div>
        <div class="box" style="background-color: {{col.17}};">
             {{lett.3.2}}
         </div>
        <div class="box" style="background-color: {{col.18}};">
             {{lett.3.3}}
         </div>
        <div class="box" style="background-color: {{col.19}};">
             {{lett.3.4}}
         </div>
     </div>
     <div class="box_row">
        <div class="box" style="background-color: {{col.20}};">
             {{lett.4.0}}
         </div>
        <div class="box" style="background-color: {{col.21}};">
             {{lett.4.1}}
         </div>
        <div class="box" style="background-color: {{col.22}};">
             {{lett.4.2}}
         </div>
        <div class="box" style="background-color: {{col.23}};">
             {{lett.4.3}}
         </div>
        <div class="box" style="background-color: {{col.24}};">
             {{lett.4.4}}
         </div>
     </div>
     <div class="box_row">
        <div class="box" style="background-color: {{col.25}};">
             {{lett.5.0}}
         </div>
        <div class="box" style="background-color: {{col.26}};">
             {{lett.5.1}}
         </div>
        <div class="box" style="background-color: {{col.27}};">
             {{lett.5.2}}
         </div>
        <div class="box" style="background-color: {{col.28}};">
             {{lett.5.3}}
         </div>
        <div class="box" style="background-color: {{col.29}};">
             {{lett.5.4}}
         </div>
     </div>
    <div style="height: 10px;"></div>
    {%if win == '0'%}
    <div >
        <form id="keyboard-form" action="" method="POST" >
            {% csrf_token %}
            <div style="height: 20px;" class="box_row">
                
                <input id = "input-box" type="text" name="inputText" placeholder="Click keys here" readonly style="height: 30px; margin-top: 8px;">
            </div>
            <div class="keyboard" id="keyboard">
                <div class="row">
                <div class="key">Q</div>
                <div class="key">W</div>
                <div class="key">E</div>
                <div class="key">R</div>
                <div class="key">T</div>
                <div class="key">Y</div>
                <div class="key">U</div>
                <div class="key">I</div>
                <div class="key">O</div>
                <div class="key">P</div>
            </div>
            <div class="row">
                <div class="key">A</div>
                <div class="key">S</div>
                <div class="key">D</div>
                <div class="key">F</div>
                <div class="key">G</div>
                <div class="key">H</div>
                <div class="key">J</div>
                <div class="key">K</div>
                <div class="key">L</div>
            </div>
            <div class="row">
                <div class="key">Del</div>
                <div class="key">Z</div>
                <div class="key">X</div>
                <div class="key">C</div>
                <div class="key">V</div>
                <div class="key">B</div>
                <div class="key">N</div>
                <div class="key">M</div>
                <button type="submit" id="submit" class="key" style="width: 70px;">Submit</button>
            </div>
        </div>
    </form>
    </div>
    {%else%}
    <div style='color:white; font-size: large;justify-content: center;align-items: center; text-align: center;'>
        Solved
    </div>
    {%endif%}

</body>
<script>
    // Select the input box and keyboard
    const inputBox = document.getElementById("input-box");
    const keyboard = document.getElementById("keyboard");

// Add an event listener to the keyboard
keyboard.addEventListener("click", function(event) {
    if (event.target.classList.contains("key")) {
        const keyValue = event.target.textContent;
        if (keyValue == 'Del') {
            inputBox.value = inputBox.value.slice(0,-1);
            return;
        }
        if (inputBox.value.length >= 5) {
            return;
        }
        else
            inputBox.value += keyValue; // Append to the input box
    }
});

document.getElementById("keyboard-form").addEventListener("submit", function(event) {
    // event.preventDefault()
    const inputText = document.getElementById("input-box").value;
    console.log(inputText.length)
    if (inputText.length < 5)
    {
        return
    }
    document.getElementById("input-box").value = '';
    console.log(JSON.stringify({ inputText }));
    fetch("", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": document.querySelector("[name=csrfmiddlewaretoken]").value,
        },
        body: JSON.stringify({ inputText }),
    })
        .then(response => response.text())
        .then(data => {
            // console.log("Response from backend:", data);
            // alert(data); // Display response
        })
        .catch(error => console.error("Error:", error));
});
{%if win == '0'%}
document.addEventListener("DOMContentLoaded", function () {
    const inputBox = document.getElementById("input-box");

    // Listen for physical keyboard keypresses
    document.addEventListener("keydown", function (event) {
        const key = event.key;
        if (event.ctrlKey || event.altKey || event.metaKey ) {
            return; // Exit the function without handling the key
        }
        // Allow only alphabet keys
        if (/^[a-zA-Z]$/.test(key)) {
            if(inputBox.value.length >=5) return;
            inputBox.value += key.toUpperCase(); // Convert to uppercase and add to the input box
        } else if (key === "Backspace") {
            // Allow backspace to remove characters
            inputBox.value = inputBox.value.slice(0, -1);
        }
        else if (key == "Enter" && inputBox.value.length == 5) {
            const inputText = inputBox.value
            fetch("", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": document.querySelector("[name=csrfmiddlewaretoken]").value,
                },
                body: JSON.stringify({ inputText }),
            }).finally(() => {
                // Reload the page after sending the request
                window.location.reload();
            });
        }

        // Prevent other keys from being input
        // event.preventDefault();
    });
});
{%endif%}

</script>
</html>